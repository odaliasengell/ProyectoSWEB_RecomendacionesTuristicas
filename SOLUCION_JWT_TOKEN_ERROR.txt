ğŸ” SOLUCIÃ“N: Error "Signature verification failed" - JWT Token
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA IDENTIFICADO:
âŒ Token invÃ¡lido: Signature verification failed
   POST http://localhost:8002/payments/ 401 (Unauthorized)

CAUSA RAÃZ:
La clave JWT_SECRET_KEY en local_jwt_validator.py era un placeholder genÃ©rico
que NO coincidÃ­a con la clave utilizada por auth-service para firmar tokens.

CLAVES ANTES (INCORRECTAS):
  payment-service/local_jwt_validator.py:
    JWT_SECRET_KEY = "your-super-secret-jwt-key-change-in-production-123456789"
  
  auth-service/local_jwt_validator.py:
    JWT_SECRET_KEY = "your-super-secret-jwt-key-change-in-production-123456789"

CLAVES DESPUÃ‰S (SINCRONIZADAS):
  payment-service/local_jwt_validator.py:
    JWT_SECRET_KEY = "integracion-turismo-2026-uleam-jwt-secret-key-payment-service"
  
  auth-service/local_jwt_validator.py:
    JWT_SECRET_KEY = "integracion-turismo-2026-uleam-jwt-secret-key-payment-service"

ARCHIVOS ACTUALIZADOS:
âœ… backend/payment-service/local_jwt_validator.py - LÃ­nea 28
âœ… backend/auth-service/local_jwt_validator.py - LÃ­nea 28

SINCRONIZACIÃ“N DE CLAVES COMPLETA:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

JWT_SECRET_KEY = "integracion-turismo-2026-uleam-jwt-secret-key-payment-service"

Ubicaciones sincronizadas:
  âœ… backend/auth-service/.env
  âœ… backend/auth-service/local_jwt_validator.py
  âœ… backend/payment-service/.env
  âœ… backend/payment-service/local_jwt_validator.py
  âœ… backend/rest-api/.env

INTEGRACION_SECRET_KEY = "integracion-turismo-2026-uleam"

Ubicaciones configuradas:
  âœ… backend/auth-service/.env
  âœ… backend/payment-service/.env
  âœ… backend/rest-api/.env

FLUJO DE TOKEN (AHORA CORRECTO):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Frontend solicita login a Auth Service (puerto 8001)
   POST /auth/login

2. Auth Service genera token con JWT_SECRET_KEY
   jwt.encode(payload, JWT_SECRET_KEY, algorithm="HS256")
   â†’ Token generado: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

3. Frontend guarda token en localStorage
   localStorage.setItem('token', token)

4. Frontend envÃ­a pago a Payment Service (puerto 8002)
   POST /payments/
   Headers: Authorization: Bearer <token>

5. Payment Service valida token con local_jwt_validator.py
   jwt.decode(token, JWT_SECRET_KEY, algorithms=["HS256"])
   
   âœ… AHORA: Usa la MISMA clave secreta
   âŒ ANTES: Usaba clave diferente â†’ Error 401

6. Si validaciÃ³n OK:
   âœ… Procesar pago
   âœ… Retornar 201 Created

QUÃ‰ HACER AHORA:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Reiniciar servicios:
   
   Terminal 1 (Auth Service):
   cd backend/auth-service
   python main.py
   
   Terminal 2 (Payment Service):
   cd backend/payment-service
   python main.py
   
   Terminal 3 (REST API):
   cd backend/rest-api
   python -m uvicorn main:app --reload --port 8000

2. Recargar frontend y intentar pago nuevamente

3. Verificar que funcione correctamente (status 201)

VERIFICACIÃ“N:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Claves JWT sincronizadas entre:
   - Auth Service
   - Payment Service
   - REST API

âœ… local_jwt_validator.py actualizado con clave correcta en:
   - auth-service/
   - payment-service/

âœ… .env files consistentes

âœ… Todos los servicios usan HMAC-SHA256

STATUS: ğŸŸ¢ LISTO PARA REINTENTO

Reinicia los servicios y prueba el pago nuevamente. DeberÃ­a funcionar sin error 401.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Fecha: 25 de enero de 2026
