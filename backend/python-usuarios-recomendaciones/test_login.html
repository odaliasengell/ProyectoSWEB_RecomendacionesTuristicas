<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Login</title>
    <style>
      body {
        font-family: Arial;
        margin: 50px;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        cursor: pointer;
      }
      pre {
        background: #f0f0f0;
        padding: 10px;
        border-radius: 5px;
        overflow-x: auto;
      }
      .result {
        margin-top: 20px;
      }
      .error {
        color: red;
      }
      .success {
        color: green;
      }
      input {
        padding: 8px;
        margin: 5px;
        width: 300px;
      }
    </style>
  </head>
  <body>
    <h1>Test Backend Auth</h1>

    <h2>Test Login</h2>
    <input
      id="email"
      type="email"
      placeholder="Email"
      value="ayalasarapruebas@gmail.com"
    />
    <input
      id="password"
      type="password"
      placeholder="Contraseña"
      value="123456"
    />
    <button onclick="testLogin()">Test POST /auth/token</button>

    <h2>Test Register</h2>
    <input id="nombre" type="text" placeholder="Nombre" value="Test User" />
    <input
      id="reg-email"
      type="email"
      placeholder="Email"
      value="testuser@example.com"
    />
    <input
      id="reg-password"
      type="password"
      placeholder="Contraseña"
      value="123456"
    />
    <input id="pais" type="text" placeholder="País" value="Ecuador" />
    <button onclick="testRegister()">Test POST /auth/register</button>

    <h2>Test Health</h2>
    <button onclick="testHealth()">Test GET /health</button>

    <div id="result" class="result">
      <p>Resultados aparecerán aquí...</p>
    </div>

    <script>
      async function testHealth() {
        try {
          console.log('[TEST] Calling GET /health');
          const res = await fetch('http://localhost:8000/health');
          const data = await res.json();
          document.getElementById('result').innerHTML = `
                    <h3 class="success">GET /health (${res.status})</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
        } catch (e) {
          document.getElementById(
            'result'
          ).innerHTML = `<h3 class="error">ERROR: ${e.message}</h3>`;
          console.error('[ERROR]', e);
        }
      }

      async function testLogin() {
        try {
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;

          console.log('[TEST] Calling POST /auth/token', { email, password });

          const res = await fetch('http://localhost:8000/auth/token', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              email: email,
              contraseña: password,
            }),
          });

          const data = await res.json();
          console.log('[RESPONSE]', res.status, data);

          if (res.ok) {
            document.getElementById('result').innerHTML = `
                        <h3 class="success">POST /auth/token (${
                          res.status
                        }) ✓</h3>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
          } else {
            document.getElementById('result').innerHTML = `
                        <h3 class="error">POST /auth/token (${
                          res.status
                        }) ✗</h3>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
          }
        } catch (e) {
          document.getElementById(
            'result'
          ).innerHTML = `<h3 class="error">ERROR: ${e.message}</h3>`;
          console.error('[ERROR]', e);
        }
      }

      async function testRegister() {
        try {
          const nombre = document.getElementById('nombre').value;
          const email = document.getElementById('reg-email').value;
          const password = document.getElementById('reg-password').value;
          const pais = document.getElementById('pais').value;

          console.log('[TEST] Calling POST /auth/register', {
            nombre,
            email,
            password,
            pais,
          });

          const res = await fetch('http://localhost:8000/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              nombre: nombre,
              email: email,
              contraseña: password,
              pais: pais,
            }),
          });

          const data = await res.json();
          console.log('[RESPONSE]', res.status, data);

          if (res.ok || res.status < 400) {
            document.getElementById('result').innerHTML = `
                        <h3 class="success">POST /auth/register (${
                          res.status
                        }) ✓</h3>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
          } else {
            document.getElementById('result').innerHTML = `
                        <h3 class="error">POST /auth/register (${
                          res.status
                        }) ✗</h3>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
          }
        } catch (e) {
          document.getElementById(
            'result'
          ).innerHTML = `<h3 class="error">ERROR: ${e.message}</h3>`;
          console.error('[ERROR]', e);
        }
      }
    </script>
  </body>
</html>
